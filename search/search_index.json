{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"M346 - Dokumentation","text":""},{"location":"#einleitung","title":"\u2712\ufe0f Einleitung","text":"<p>Willkommen zur offiziellen Dokumentation des M346-Moduls! Diese Dokumentation bietet eine umfassende Anleitung zur Verwendung des M346-Moduls, das entwickelt wurde, um das Verkleinern von Bildgr\u00f6\u00dfen zu erleichtern.</p> <p>Wir haben ein Skript erstellt, das mithilfe von AWS CLI automatisch die Gr\u00f6\u00dfe von Bildern reduziert. Dies wird durch die Integration von AWS S3 und Lambda-Funktionen erm\u00f6glicht, die eine nahtlose und effiziente Verarbeitung erm\u00f6glichen.</p> <p>Unter Code finden Sie unser Skript mit den einzelnen Erkl\u00e4rungen.</p> <p>Unter Test finden Sie die Tests zu unseren jeweiligen Codes.</p>"},{"location":"#installation","title":"\u2699\ufe0f Installation","text":""},{"location":"#1-systemanforderungen","title":"1. Systemanforderungen","text":"<ul> <li>Stellen Sie sicher, dass Sie \u00fcber eine stabile <code>Internetverbindung</code> verf\u00fcgen.</li> <li>Stellen Sie sicher, dass die <code>AWS CLI</code> auf Ihrem System installiert ist und ordnungsgem\u00e4ss konfiguriert ist.</li> <li>Konfigurieren Sie die AWS CLI mit Ihren AWS-Zugriffsschl\u00fcsseln, indem Sie aws configure in der Befehlszeile ausf\u00fchren. Sie ben\u00f6tigen Zugriffsschl\u00fcssel mit ausreichenden Berechtigungen, um auf die AWS-Services zuzugreifen, die Ihr Lambda-Skript ben\u00f6tigt.</li> </ul>"},{"location":"#verwendung","title":"\ud83d\uddbc\ufe0f Verwendung","text":"<p>Das Skript wird verwendet, um Bilder zu bearbeiten, insbesondere solche, die Sie in der Cloud hochladen m\u00f6chten. Es ist darauf spezialisiert, die Gr\u00f6sse der Bilder zu verkleinern, um deren Effizienz beim Hochladen und Speichern in der Cloud zu verbessern. Diese Gr\u00f6ssenanpassung kann dazu beitragen, die Ladezeiten von Webseiten zu optimieren, Speicherplatz zu sparen und die allgemeine Leistung der Cloud-Anwendung zu steigern.</p>"},{"location":"#lizenzinformationen","title":"\ud83d\udd11 Lizenzinformationen","text":"<p>Die bereitgestellten Skripte und Codebeispiele unterliegen der MIT-Lizenz. Das bedeutet, dass Sie diese frei verwenden, modifizieren und verbreiten k\u00f6nnen.</p>"},{"location":"Skript/","title":"M346 - Skript","text":""},{"location":"Skript/#skript-dokumentation-img-reducer-scriptsh","title":"Skript-Dokumentation: img-reducer-script.sh","text":""},{"location":"Skript/#installation-und-konfiguration-von-aws-cli","title":"Installation und Konfiguration von AWS CLI","text":"<p>Das Skript \u00fcberpr\u00fcft zun\u00e4chst, ob die AWS CLI bereits installiert ist. Falls nicht, wird sie installiert. Anschliessend wird die Konfigurationsdatei f\u00fcr die AWS CLI erstellt, falls sie noch nicht existiert. Der Benutzer wird aufgefordert, seine AWS-Zugangsdaten einzugeben, und die eingegebenen Daten werden in der Konfigurationsdatei gespeichert.</p> <pre><code># Checking if aws CLI is installed\nif command -v aws &amp;&gt; /dev/null\nthen\n    echo \"AWS CLI is already installed.\"\nelse\n    echo \"AWS CLI ist installing...\"\n\n    # Installing AWS CLI\n    sudo apt-get update\n    sudo apt-get install -y awscli\n\n    # Checking if installation was successful\n    if command -v aws &amp;&gt; /dev/null\n    then\n        echo \"AWS CLI installed successfully.\"\n    else\n        echo \"Error installing AWS CLI. Please check installation instructions for your system.\"\n        exit 1\n    fi\nfi\n\nCONFIGFILE=~/.aws/config\n\n# Checking if AWS configuration file exists\nif [ -f \"$CONFIGFILE\" ]; then\n    echo \"AWS configuration already exists.\"\nelse\n    echo \"AWS configuration does not exist. Creating configuration now.\"\n\n    # Creating configuration\n    aws configure\n    echo \"Session token with the variable aws_session_token= :\"\n    read userInput\n    chmod --recursive 777 ~/.aws\n    echo \"$userInput\" &gt;&gt; ~/.aws/credentials\n\n    # Checking if configuration was created successfully\n    if [ -f \"$CONFIGFILE\" ]; then\n        echo \"AWS configuration created successfully.\"\n    else\n        echo \"Error creating AWS configuration.\"\n        exit 1\n    fi\nfi\n\nARN=$(aws sts get-caller-identity --query \"Account\" --output text)\n\nsed -i \"s/ACCOUNT_ID/${ARN}/g\" index-notification.json\n</code></pre>"},{"location":"Skript/#bucket-erstellen","title":"Bucket erstellen","text":"<p>In diesem Code wartet das Skript darauf, dass der Benutzer einen g\u00fcltigen Bucket-Namen eingibt, und erstellt dann den Bucket, wenn der eingegebene Name nicht bereits verwendet wird.</p> <pre><code>BUCKETORIGINAL=\"\"\n\nBUCKETCOMPRESSED=\"\"\n\nRESIZEPERCENTAGE=0\n\n# Creating the lambda function\nwhile true; do\n\n    # Asking for bucket name\n    echo \"Name of the bucket for original images:\"\n    # Storing in variable\n    read BUCKETORIGINAL\n\n    # Checking if bucket exists\n    RESULT=$(aws s3api head-bucket --bucket $BUCKETORIGINAL 2&gt;&amp;1)\n\n    echo $RESULT\n    # Checking response\n    if [[ $RESULT = *404* ]]\n    then\n        echo \"Bucket $BUCKETORIGINAL is available\"\n        echo \"-----------------------------------------------------------------\"\n        aws s3 mb s3://$BUCKETORIGINAL\n        echo \"-----------------------------------------------------------------\"\n        break\n    else\n        echo \"Bucket $BUCKETORIGINAL is not available, please try again\"\n        echo \"-----------------------------------------------------------------\"\n    fi\ndone\n</code></pre>"},{"location":"Skript/#bucket-erstellen-fur-komprimierte-bilder-und-prozentzahl","title":"Bucket erstellen f\u00fcr Komprimierte Bilder und Prozentzahl","text":"<p>Dieser Codeblock enth\u00e4lt zwei while-Schleifen, die den Benutzer zur Eingabe eines Bucket-Namens f\u00fcr komprimierte Bilder und eines Prozentsatzes f\u00fcr die Bildgr\u00f6\u00dfen\u00e4nderung auffordern. Hier ist eine Zusammenfassung:</p> <pre><code>while true; do\n    # Asking for bucket name\n    echo \"Name of the bucket for compressed images:\"\n    # Storing in variable\n    read BUCKETCOMPRESSED\n\n    # Checking if bucket exists\n    RESULT=$(aws s3api head-bucket --bucket $BUCKETCOMPRESSED 2&gt;&amp;1)\n\n    # Checking response\n    if [[ $RESULT = *404* ]]\n    then\n        echo \"Bucket $BUCKETCOMPRESSED is available\"\n        echo \"-----------------------------------------------------------------\"\n        aws s3 mb s3://$BUCKETCOMPRESSED\n        echo \"-----------------------------------------------------------------\"\n        break\n    else\n        echo \"Bucket $BUCKETCOMPRESSED is not available, please try again\"\n        echo \"-----------------------------------------------------------------\"\n    fi\ndone\n\nwhile true; do\n    echo \"Percentage for resizing the image:\"\n    read RESIZEPERCENTAGE\n\n    if [[ $RESIZEPERCENTAGE =~ ^[0-9]+$ ]]; then\n        echo \"Percentage: $RESIZEPERCENTAGE%.\"\n        break\n    else\n        echo \"Error: Not valid percentage. (number without percent sign)\"\n    fi\ndone\n</code></pre>"},{"location":"Skript/#lambda-funktion-erstellen-und-konfigurieren","title":"Lambda-Funktion erstellen und konfigurieren","text":"<p>Das Skript erstellt eine Lambda-Funktion namens \"imageConverter\", falls sie noch nicht vorhanden ist. Dabei wird die Funktion f\u00fcr die Ausf\u00fchrung mit der Laufzeit Node.js 18.x konfiguriert. Es wird auch eine Berechtigung hinzugef\u00fcgt, damit die Lambda-Funktion von S3-Events ausgel\u00f6st werden kann.</p> <pre><code># Checking if lambda function exists\nexisting_function=$(aws lambda get-function --function-name \"imageConverter\" 2&gt;/dev/null)\n\nif [ $? -eq 0 ]; then\n    # If the function exists, delete it\n    aws lambda delete-function --function-name imageConverter\n    echo \"Existing Lambda function deleted.\"\nfi\n\n# Creating the lambda function\naws lambda create-function --function-name imageConverter --runtime nodejs18.x --role arn:aws:iam::$ARN:role/LabRole --handler img-reducer-lamda.handler --zip-file fileb://./img-reducer-lamda.zip --memory-size 256\n\n# Adding permission for S3 bucket and S3 trigger\naws lambda add-permission --function-name imageConverter --action \"lambda:InvokeFunction\" --principal s3.amazonaws.com --source-arn arn:aws:s3:::$BUCKETORIGINAL --statement-id \"$BUCKETORIGINAL\"\n\naws s3api put-bucket-notification-configuration --bucket \"$BUCKETORIGINAL\" --notification-configuration '{\n    \"LambdaFunctionConfigurations\": [\n        {\n            \"LambdaFunctionArn\": \"arn:aws:lambda:us-east-1:'$ARN':function:imageConverter\",\n            \"Events\": [\n                \"s3:ObjectCreated:Put\"\n            ]\n        }\n    ]\n}'\n</code></pre>"},{"location":"Skript/#hochladen-des-bildes","title":"Hochladen des Bildes","text":"<p>In diesem kurzen Abschnitt, werden die Variablen der Lambda-Funktion \u00fcbergeben und das Bild wird in die das erste Bucket hochgeladen.</p> <pre><code># Passing the variables\naws lambda update-function-configuration --function-name imageConverter --environment \"Variables={BUCKET_NAME_ORIGINAL=$BUCKETORIGINAL,BUCKET_NAME_COMPRESSED=$BUCKETCOMPRESSED, PERCENTAGE_RESIZE=$RESIZEPERCENTAGE}\" --query \"Environment\"\n\n# Uploading the image to the source bucket\naws s3 cp ImageTest.jpg s3://$BUCKETORIGINAL/ImageTest.jpg\n\nsleep 5\n</code></pre>"},{"location":"Skript/#herunterladen-des-verkleinerten-bildes","title":"Herunterladen des verkleinerten Bildes","text":"<p>Das Bild wird auf dem Bucket hochgeladen</p> <pre><code>echo \"-----------------------------------------------------------------\"\n     echo \"The image was uploaded :)\"\necho \"-----------------------------------------------------------------\"\n</code></pre> <p>Das Skript bietet eine umfassende Automatisierungsl\u00f6sung f\u00fcr Bildverkleinerungsaufgaben und erm\u00f6glicht eine einfache Konfiguration und Verwendung von AWS-Diensten.</p>"},{"location":"Skript/#skript-dokumentation-img-reducer-lamdazip","title":"Skript-Dokumentation: img-reducer-lamda.zip","text":"<pre><code>'use strict';\n\nconst AWS = require('aws-sdk');\nconst sharp = require('sharp');\n\nexports.handler = async (event, context) =&gt; {\n    // Creating an instance of the AWS S3 service\n    const s3 = new AWS.S3();\n\n    // Extracting the name of the original bucket from the S3 event\n    const bucket = event.Records[0].s3.bucket.name;\n\n    // Extracting the filename/key of the object triggering the event\n    const key = decodeURIComponent(event.Records[0].s3.object.key.replace(/\\+/g, ' '));\n\n    // percentage resize \n    let percentageResize = process.env.PERCENTAGE_RESIZE;\n\n    try {\n        // Retrieving the image data from the original bucket\n        const data = await s3.getObject({ Bucket: bucket, Key: key }).promise();\n        const image = sharp(data.Body);\n\n        // Calculating the new size + metadata for image \n        const metadata = await image.metadata();\n        let size = Math.round(metadata.width * percentageResize / 100);\n        console.log(`Resizing ${key} to ${size}`);\n        let resizedImage = await image.resize(size).toBuffer();\n\n        // Uploading the resized image to the specified bucket\n        await s3.putObject({\n            Body: resizedImage,\n            Bucket: s3.listObjects(process.env.BUCKET_NAME_COMPRESSED).params,\n            Key: `resized-${key}`,\n            ContentType: 'image/jpeg'\n        }).promise();\n\n        console.log(`Resized ${key} &amp; uploaded to bucket`);\n\n    } catch (err) {\n        console.error(err);\n    }\n};\n</code></pre>"},{"location":"Tests/","title":"M346 - Tests","text":""},{"location":"Tests/#bucketname-grossschreibung","title":"Bucketname Grossschreibung","text":"<p>Der Bucketname muss am anfang klein geschrieben werden. Fals das nicht der Fall ist wird der Benutzer wieder aufgefordet f\u00fcr eine Wiedereingabe.</p> <p></p>"},{"location":"Tests/#invalide-verkleinerungsprozent-eingabe","title":"invalide Verkleinerungsprozent eingabe","text":"<p>Wenn der Benutzer eine Invalide Prozenteingabe t\u00e4tigt wird f\u00fcr eine ordentliche Eingabe aufgefordert.</p> <p></p>"},{"location":"Tests/#wird-lambda-function-richtig-erstellt-konfiguriert","title":"Wird Lambda-Function richtig erstellt konfiguriert?","text":"<p>In diesem Beispiel k\u00f6nnen wir erkennen, dass die existierende Lambda-Function gel\u00f6scht wurde und die neue erstellt und die richtige Konfiguration \u00fcbergeben wurde.</p> <p></p>"}]}